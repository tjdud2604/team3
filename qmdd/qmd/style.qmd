---
title: ""
author: ""
format:
  revealjs:
    theme: default
    transition: fade         # ìŠ¬ë¼ì´ë“œ ì „í™˜ íš¨ê³¼ âœ¨
    slide-number: true       # ìŠ¬ë¼ì´ë“œ ë²ˆí˜¸ í‘œì‹œ ğŸ”¢
    toc: false                # ëª©ì°¨ í‘œì‹œ ğŸ—‚ï¸
    toc-depth: 2             # ëª©ì°¨ ê¹Šì´ ì„¤ì •
    css: style.css           # ê·€ì—¬ìš´ ê¾¸ë°ˆ CSS ì—°ê²° ğŸ€
    auto-stretch: true       # ì½˜í…ì¸  ìë™ ì •ë ¬/stretch
    center: true               # ëª¨ë“  ì½˜í…ì¸  ê°€ìš´ë° ì •ë ¬
    highlight-style: github   # ì½”ë“œ ë¸”ë¡ ìŠ¤íƒ€ì¼ ì˜ˆì˜ê²Œ
    chalkboard: true          # ë°œí‘œ ì¤‘ ì¹ íŒ ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥
---
<!-- íƒ€ì´í‹€ ìŠ¬ë¼ì´ë“œ ë‚´ìš© -->
<div style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
  <h1>ğŸš¦ ë©ˆì¶°! êµí†µì‚¬ê³ ! </h1>
  <h3>3ì¡° - LSë¹…ë°ì´í„°ìŠ¤ì¿¨</h3>
  <img src="photo/Visual.png" width="300"/>
  <p>êµí†µì‚¬ê³ , ë‹¹ì‹ ì˜ ë°ì´í„°ëŠ” ì•Œê³  ìˆë‹¤ </p>
</div>
---

## Table of content

1. íŒ€ ì†Œê°œ <br>
2. í”„ë¡œì íŠ¸ ê°œìš” <br>
3. í”„ë¡œì íŠ¸ ëª©ì  <br>
4. í”„ë¡œì íŠ¸ ê°€ì„¤ <br>
5. ë¶„ì„ ì§„í–‰ ë° ê²°ê³¼ <br>

## ğŸ“Œ íŒ€ ì†Œê°œ

-   ì´ë¦„: **3ì¡°** ğŸ“
-   êµ¬ì„±ì›: í¸ì„œì˜, í•œì§€ìˆ˜, ì˜¤ìƒì›, ì´ì°½í˜

------------------------------------------------------------------------

## ğŸ“Š í”„ë¡œì íŠ¸ ê°œìš”

- êµí†µì‚¬ê³ ëŠ” ë‹¨ìˆœí•œ ìš´ì „ì ì‹¤ìˆ˜ë§Œì˜ ë¬¸ì œê°€ ì•„ë‹™ë‹ˆë‹¤! ğŸš—, ğŸš•, ğŸš™
- ì „êµ­ ë‹¨ì†ì¹´ë©”ë¼ ì„¤ì¹˜ì •ë³´, ë„ë¡œ ì†ì„±, ì§€ì—­ ë“±ì„ í†µí•©í•˜ì—¬ íƒìƒ‰!  
- ë°ì´í„°ëŠ” ë§í•©ë‹ˆë‹¤ ğŸ•µï¸ ì‚¬ê³ ëŠ” ì˜ˆë°©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

------------------------------------------------------------------------

## ğŸ¯ í”„ë¡œì íŠ¸ ëª©ì 

::: center
**êµí†µì‚¬ê³  ë°œìƒê±´ìˆ˜ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ìš”ì¸ë¶„ì„**
:::

::: center
<img src="photo/search.png" style="float: right" width="300"/>
:::

------------------------------------------------------------------------

## ğŸ” í”„ë¡œì íŠ¸ ê°€ì„¤ ì„¤ì •

1. **ë„ë¡œ ì¢…ë¥˜**ì— ë”°ë¼ ì‚¬ê³  ê±´ìˆ˜ì— ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ìˆë‹¤.
2. **ê° ì‹œë„ë³„ ì‚¬ê³ ê±´ìˆ˜**ê°€ ì°¨ì´ê°€ ìˆì„ ê²ƒì´ë‹¤.
3. **ë‹¨ì†ì¹´ë©”ë¼ ìˆ˜**ê°€ ì‚¬ê³  ê±´ìˆ˜ì— ì˜í–¥ì„ ë¯¸ì¹  ê²ƒì´ë‹¤. 
4. **ë„ë¡œë…¸ì„ ** ìœ ë¬´ì— ë”°ë¼ ì‚¬ê³  ê±´ìˆ˜ ì°¨ì´ê°€ ìˆì„ ê²ƒì´ë‹¤.

------------------------------------------------------------------------

## ğŸ§ª ë¶„ì„ì§„í–‰
<img src="photo/Starman.png" style="float: right" width="200"/>

------------------------------------------------------------------------

- ë°ì´í„° ì¶œì²˜ ë° ì„¤ëª…

<img src="photo/êµí†µì‚¬ê³  í†µê³„.png" width="900"/>
<img src="photo/ë‹¨ì†ì¹´ë©”ë¼.png" width="900"/>

------------------------------------------------------------------------

- ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°

```{python}
#| echo: true
import pandas as pd
import numpy as np
import matplotlib as mpl

mpl.rcParams['font.family'] = 'Malgun Gothic'
camera = pd.read_csv('../team2/data/camera.csv')
accident = pd.read_csv('../team2/data/accident.csv', encoding='cp949')
```

---------

- ë°ì´í„° ì •ë³´ í™•ì¸
```{python}
print(camera.info())
```

---------

- ë°ì´í„° ì •ë³´ í™•ì¸
```{python}
print(accident.info())
```

------------------------------------------------------------------------

- ê°€ì„¤ 1 ë¶„ì„ ì§„í–‰ : ì§€ì—­ë³„ ëŒ€í‘œë„ë¡œ ì‚¬ê³ ê±´ìˆ˜ ë¹„êµ

```{python}
#| echo: true
#| code-fold: true

accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ì„œìš¸', 'ì„œìš¸íŠ¹ë³„ì‹œ')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ë¶€ì‚°', 'ë¶€ì‚°ê´‘ì—­ì‹œ')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ê²½ê¸°', 'ê²½ê¸°ë„')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ê²½ë‚¨', 'ê²½ìƒë‚¨ë„')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ì „ë‚¨', 'ì „ë¼ë‚¨ë„')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ê²½ë¶', 'ê²½ìƒë¶ë„')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ì „ë¶', 'ì „ë¼ë¶ë„')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ëŒ€êµ¬', 'ëŒ€êµ¬ê´‘ì—­ì‹œ')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ìš¸ì‚°', 'ìš¸ì‚°ê´‘ì—­ì‹œ')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ì¸ì²œ', 'ì¸ì²œê´‘ì—­ì‹œ')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ì œì£¼', 'ì œì£¼íŠ¹ë³„ìì¹˜ë„')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ì¶©ë‚¨', 'ì¶©ì²­ë‚¨ë„')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ì¶©ë¶', 'ì¶©ì²­ë¶ë„')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ê°•ì›', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ëŒ€ì „', 'ëŒ€ì „ê´‘ì—­ì‹œ')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ì„¸ì¢…', 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ')
accident['ì‹œë„ëª…'] = accident['ì‹œë„ëª…'].replace('ê´‘ì£¼', 'ê´‘ì£¼ê´‘ì—­ì‹œ')

```

```{python}
#| echo: true
# ì‚¬ê³  ë‹¤ë°œ ì •ë¦¬
theeshold = accident['ì‚¬ê³ ê±´ìˆ˜'].quantile(0.75)
accident['ì‚¬ê³ ë‹¤ë°œ'] = accident['ì‚¬ê³ ê±´ìˆ˜'].apply(lambda x: 'ë‹¤ë°œ' if x >= theeshold else 'ë³´í†µ')

# ì‹œë„ ë³„ ëŒ€í‘œë„ë¡œ ì„ ì •
road_type = camera.groupby('ì‹œë„ëª…')['ë„ë¡œì¢…ë¥˜'].agg(lambda x: x.value_counts().index[0]).reset_index(name='ëŒ€í‘œë„ë¡œì¢…ë¥˜')
road_type = road_type.rename(columns={'ë„ë¡œì¢…ë¥˜': 'ëŒ€í‘œë„ë¡œì¢…ë¥˜'})
```

------------------------------------------------------------------------

- ê°€ì„¤ 1 ë¶„ì„ ì§„í–‰ : ì§€ì—­ë³„ ëŒ€í‘œë„ë¡œ ì‚¬ê³ ê±´ìˆ˜ ë¹„êµ
```{python}
#| echo: true
# ë°ì´í„° ë³‘í•©
acc_road = pd.merge(road_type, accident, on='ì‹œë„ëª…')

# ë„ë¡œì¢…ë¥˜ vs ì‚¬ê³ ë‹¤ë°œ
ct = pd.crosstab(acc_road['ëŒ€í‘œë„ë¡œì¢…ë¥˜'], acc_road['ì‚¬ê³ ë‹¤ë°œ'])

ct.loc['ì¼ë°˜êµ­ë„'] = ct.loc['ì¼ë°˜êµ­ë„'] + ct.loc['ì§€ë°©ë„']
ct = ct.drop(['ì§€ë°©ë„'])
```

------------------------------------------------------------------------

```{python}
# ìŠ¤íƒ€ì¼ë§í•´ì„œ ì˜ˆì˜ê²Œ ì¶œë ¥
ct.style.set_table_styles([
    {'selector': 'th', 'props': [('background-color', '#f4d9c6'),
                                 ('color', '#333'),
                                 ('text-align', 'center'),
                                 ('font-family', 'Jua'),
                                 ('font-size', '1.1em')]},
    {'selector': 'td', 'props': [('text-align', 'center'),
                                 ('font-family', 'Jua'),
                                 ('padding', '10px')]},
    {'selector': '', 'props': [('border', '1px solid #ddd'),
                               ('border-collapse', 'collapse')]}
]).set_caption("ğŸš¦ ëŒ€í‘œ ë„ë¡œì¢…ë¥˜ë³„ ì‚¬ê³ ë‹¤ë°œ ë¹ˆë„í‘œ") \
  .set_properties(**{
      'background-color': '#fffdf9',
      'border-color': '#eee',
      'border-style': 'solid',
      'border-width': '1px'
  })
```

------------------------------------------------------------------------

- ê°€ì„¤ 1 ë¶„ì„ ì§„í–‰ : ì§€ì—­ë³„ ëŒ€í‘œë„ë¡œ ì‚¬ê³ ê±´ìˆ˜ ë¹„êµ
```{python}
#| echo: true
# ì¹´ì´ì œê³± ë™ì§ˆì„± ê²€ì • ì§„í–‰
from scipy.stats import chi2_contingency
import matplotlib.pyplot as plt
chi2, p, dof, exp = chi2_contingency(ct)

print(chi2, p, dof)
```

------------------------------------------------------------------------

- ì¹´ì´ì œê³± ë™ì§ˆì„± ê²€ì • ê²°ê³¼

ğŸ‘‰ ê²€ì • í†µê³„ëŸ‰ (ChiÂ²): **11.68** <br>
ğŸ‘‰ ììœ ë„ (df): **3** <br>
ğŸ‘‰ ìœ ì˜í™•ë¥  (p-value): **0.008** <br>

<div class="center">
âœ… <strong>ì°¨ì´ê°€ ìœ ì˜ë¯¸í•¨ì„ í™•ì¸!</strong> âœ…
</div>

------------------------------------------------------------------------

- ì¹´ì´ì œê³± ë™ì§ˆì„± ê²€ì • ê²°ê³¼

> \[!ğŸ¯\] **ëŒ€í‘œë„ë¡œ ì¢…ë¥˜**ì™€ **ì‚¬ê³  ë‹¤ë°œ** ì‚¬ì´ì˜ ê´€ê³„ê°€ í†µê³„ì ìœ¼ë¡œ ì°¨ì´ê°€ ìˆë‹¤ê³  ì£¼ì¥í• ë§Œí•œ í†µê³„ì  ê·¼ê±°ê°€ ì¶©ë¶„í•˜ë‹¤.

------------------------------------------------------------------------

- ëŒ€í‘œë„ë¡œ ì¢…ë¥˜ë³„ ì‚¬ê³  ê±´ìˆ˜ ë¶„í¬ ë°•ìŠ¤í”Œë¡¯
```{python}
#| echo: true
#| code-fold: true
import seaborn as sns
import matplotlib.pyplot as plt
plt.figure(figsize=(10,6))
sns.boxplot(x='ëŒ€í‘œë„ë¡œì¢…ë¥˜', y='ì‚¬ê³ ê±´ìˆ˜', data=acc_road, palette='Set2')
plt.xticks(rotation=45)
plt.title('Distribution of Accident Counts by Road Type')
plt.xlabel('Road Type')
plt.ylabel('Accident Count')
plt.show()
```

------------------------------------------------------------------------

- ëŒ€í‘œë„ë¡œ ì¢…ë¥˜ë³„ ì‚¬ê³  ë‹¤ë°œ ë¹„ìœ¨ ê·¸ë˜í”„
```{python}
#| echo: true
#| code-fold: true
ct_norm = ct.div(ct.sum(axis=1), axis=0)  # ë¹„ìœ¨ë¡œ ë³€í™˜
# ë¹„ìœ¨ ë°ì´í„°í”„ë ˆì„ì„ long-formatìœ¼ë¡œ ë³€í™˜
ct_long = ct_norm.reset_index().melt(id_vars='ëŒ€í‘œë„ë¡œì¢…ë¥˜', var_name='ì‚¬ê³ ë‹¤ë°œ', value_name='ë¹„ìœ¨')

plt.figure(figsize=(10, 6))
sns.pointplot(data=ct_long, x='ëŒ€í‘œë„ë¡œì¢…ë¥˜', y='ë¹„ìœ¨', hue='ì‚¬ê³ ë‹¤ë°œ', dodge=0.3, markers='o', linestyles='-')
plt.xticks(rotation=45)
plt.title('ë„ë¡œì¢…ë¥˜ë³„ ì‚¬ê³ ë‹¤ë°œ/ë³´í†µ ë¹„ìœ¨')
plt.ylabel('ë¹„ìœ¨')
plt.xlabel('ë„ë¡œì¢…ë¥˜')
plt.tight_layout()
plt.show()
```

------------------------------------------------------------------------

- ë„ë¡œ ì¢…ë¥˜ë³„ ì‚¬ê³  ë‹¤ë°œ ë¹„ìœ¨ ê·¸ë˜í”„

```{python}
#| code-fold: true
# accidentì— ì‚¬ê³ ë‹¤ë°œ ì—¬ë¶€ ì¶”ê°€ (ê¸°ì¡´ê³¼ ë™ì¼)
threshold = accident['ì‚¬ê³ ê±´ìˆ˜'].quantile(0.75)
accident['ì‚¬ê³ ë‹¤ë°œ'] = accident['ì‚¬ê³ ê±´ìˆ˜'].apply(lambda x: 'ë‹¤ë°œ' if x >= threshold else 'ë³´í†µ')

# cameraì™€ accident ë°ì´í„°ë¥¼ ì‹œë„ëª… ê¸°ì¤€ìœ¼ë¡œ ë‹¨ìˆœ ë³‘í•© (ë„ë¡œì¢…ë¥˜ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€)
all_road = pd.merge(camera[['ì‹œë„ëª…', 'ë„ë¡œì¢…ë¥˜']], accident[['ì‹œë„ëª…', 'ì‚¬ê³ ê±´ìˆ˜', 'ì‚¬ê³ ë‹¤ë°œ']], on='ì‹œë„ëª…')

# ë„ë¡œì¢…ë¥˜ë³„ ì‚¬ê³ ë‹¤ë°œ ë¹ˆë„ í…Œì´ë¸”
ct_all = pd.crosstab(all_road['ë„ë¡œì¢…ë¥˜'], all_road['ì‚¬ê³ ë‹¤ë°œ'])
```

```{python}
#| code-fold: true
# ë¹„ìœ¨ ê·¸ë˜í”„ ì‹œê°í™”
ct_all_norm = ct_all.div(ct_all.sum(axis=1), axis=0)
ct_all_long = ct_all_norm.reset_index().melt(id_vars='ë„ë¡œì¢…ë¥˜', var_name='ì‚¬ê³ ë‹¤ë°œ', value_name='ë¹„ìœ¨')

plt.figure(figsize=(10, 6))
sns.pointplot(data=ct_all_long, x='ë„ë¡œì¢…ë¥˜', y='ë¹„ìœ¨', hue='ì‚¬ê³ ë‹¤ë°œ', dodge=0.3, markers='o', linestyles='-')
plt.xticks(rotation=45)
plt.ylabel('ë¹„ìœ¨')
plt.xlabel('ë„ë¡œì¢…ë¥˜')
plt.title('ì „ì²´ ë„ë¡œì¢…ë¥˜ë³„ ì‚¬ê³ ë‹¤ë°œ/ë³´í†µ ë¹„ìœ¨ (Point Plot)')
plt.tight_layout()
plt.show()
```

------------------------------------------------------------------------

- Shapiro-Wilk ê²€ì • ê²°ê³¼

```{python}
#| echo: true
#| code-fold: true
from scipy.stats import shapiro
def check_normality_by_road_type(all_road):
    # ì •ê·œì„± ê²€ì • ê²°ê³¼ë¥¼ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸
    results = []

    # ê° ë„ë¡œì¢…ë¥˜ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ì •ê·œì„± ê²€ì •
    for name, group in all_road.groupby('ë„ë¡œì¢…ë¥˜'):
        stat, p = shapiro(group['ì‚¬ê³ ê±´ìˆ˜'])
        result = 'ì •ê·œë¶„í¬ ì•„ë‹˜' if p < 0.05 else 'ì •ê·œë¶„í¬'
        results.append([name, p, result])

    # ê²°ê³¼ë¥¼ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜
    df_results = pd.DataFrame(results, columns=['ë„ë¡œì¢…ë¥˜', 'p-value', 'ì •ê·œë¶„í¬ ì—¬ë¶€'])
    
    # í‘œ ì¶œë ¥
    return df_results
```

```{python}
#| echo: true
df_normality = check_normality_by_road_type(all_road)
df_normality
```

------------------------------------------------------------------------

- Kruskal Wallis H ê²€ì • ê²°ê³¼

```{python}
#| echo: true
from scipy.stats import kruskal

groups = [g['ì‚¬ê³ ê±´ìˆ˜'].values for _, g in all_road.groupby('ë„ë¡œì¢…ë¥˜')]
stat, p = kruskal(*groups)
print("Kruskal-Wallis Hê²€ì •:", p)

```

------------------------------------------------------------------------

- Kruskal Wallis H ê²€ì • ê²°ê³¼

> \[!ğŸ¯\] **ë„ë¡œ ì¢…ë¥˜**ì™€ **ì‚¬ê³ ê±´ìˆ˜** ì‚¬ì´ì˜ ë¶„í¬ ì°¨ì´ê°€ ìˆë‹¤ê³  ì£¼ì¥í• ë§Œí•œ í†µê³„ì  ê·¼ê±°ê°€ ì¶©ë¶„í•˜ë‹¤.

------------------------------------------------------------------------

- ê°€ì„¤ 2 ë¶„ì„ ì§„í–‰ : ê° ì‹œë„ë³„ ì‚¬ê³ ê±´ìˆ˜ ê°„ ì°¨ì´ ë¹„êµ

```{python}
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

# ë°ì´í„° ì „ì²˜ë¦¬ ë° í™•ì¸
plt.rcParams['font.family'] ='Malgun Gothic'
plt.rcParams['axes.unicode_minus'] =False

accident_df = pd.read_csv('../team2/data/accident.csv', encoding='cp949')

# ì‹œë„ëª… unique ê°’ ì¶œë ¥ ì˜ˆì‹œ
unique_values = accident_df['ì‹œë„ëª…'].unique()
```

------------------------------------------------------------------------

- ê° ì§€ì—­ë³„ í‰ê·  ì‚¬ê³ ê±´ìˆ˜ í™•ì¸ ë° ì‹œê°í™”
```{python}
#| echo: true

# ê° ì§€ì—­ë³„ í‰ê·  ì‚¬ê³ ê±´ìˆ˜ í™•ì¸
accident_avg = accident_df.groupby('ì‹œë„ëª…')['ì‚¬ê³ ê±´ìˆ˜'].mean().reset_index()
```

------------------------------------------------------------------------

- ê° ì§€ì—­ë³„ í‰ê·  ì‚¬ê³ ê±´ìˆ˜ í™•ì¸
```{python}
#| code-fold: true
ac_avg = accident_avg.sort_values(by='ì‚¬ê³ ê±´ìˆ˜', ascending=False)

ac_avg.head(7)
```

------------------------------------------------------------------------

- ì‹œê°í™” 

```{python}
#| echo: true
#| code-fold: true
# ê° ì§€ì—­ë³„ ì‚¬ê³ ê±´ìˆ˜ ì‹œê°í™”
plt.figure(figsize=(12, 6))
sns.boxplot(data=accident_df, x='ì‹œë„ëª…', y='ì‚¬ê³ ê±´ìˆ˜', palette='Set3')
plt.title('ì§€ì—­ë³„ ì‚¬ê³ ê±´ìˆ˜ ë¶„í¬')
plt.xlabel('ì§€ì—­')
plt.ylabel('ì‚¬ê³ ê±´ìˆ˜')
plt.xticks(rotation=45)
plt.tight_layout()
plt.grid(True)
plt.show()
```

------------------------------------------------------------------------

- ê·¸ë˜í”„ ë¹„êµ ê²°ê³¼

> \[!ğŸ¯\] ì§€ì—­ë³„ í‰ê·  ì‚¬ê³ ê±´ìˆ˜ì— **ì°¨ì´ê°€ ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ì•„ ë³´ì„**!

------------------------------------------------------------------------

- ANOVA ê²€ì •

```{python}
#| echo: true
# ê° ì‹œê³ ë³„ í‰ê·  ì‚¬ê³ ê±´ìˆ˜ ë¹„êµ: ANOVA í…Œì´ë¸”
import statsmodels.api as sm
from statsmodels.formula.api import ols

model = ols('ì‚¬ê³ ê±´ìˆ˜ ~ C(ì‹œë„ëª…)', data=accident_df).fit()

anova_results = sm.stats.anova_lm(model, typ=2)
```

ğŸ‘‰ H0: ê° ì§€ì—­ë³„ í‰ê·  ì‚¬ê³ ê±´ìˆ˜ê°€ ê°™ë‹¤. <br>
ğŸ‘‰ H1: ê° ì§€ì—­ë³„ í‰ê·  ì‚¬ê³ ê±´ìˆ˜ê°€ ì ì–´ë„ í•˜ë‚˜ëŠ” ë‹¤ë¥´ë‹¤.

------------------------------------------------------------------------

```{python}
from IPython.display import HTML

anova_results = pd.DataFrame(anova_results)

styled = anova_results.style.set_table_styles([
    {'selector': 'th', 'props': [('background-color', '#f4d9c6'),
                                 ('color', '#333'),
                                 ('text-align', 'center'),
                                 ('font-family', 'Jua'),
                                 ('font-size', '1.1em')]},
    {'selector': 'td', 'props': [('text-align', 'center'),
                                 ('font-family', 'Jua'),
                                 ('padding', '10px')]},
    {'selector': '', 'props': [('border', '1px solid #ddd'),
                               ('border-collapse', 'collapse')]}
]).set_caption("ğŸš¦ ANOVA ë¶„ì„ ê²°ê³¼í‘œ")

HTML(styled.to_html())
```

------------------------------------------------------------------------

- ANOVA ê²€ì • ê²°ê³¼

> \[!ğŸ¯\] ê° ì‹œë„ë³„ í‰ê·  ì‚¬ê³ ê±´ìˆ˜ê°€ ì ì–´ë„ í•˜ë‚˜ëŠ” **ë‹¤ë¥´ë‹¤**ë¼ê³  ì£¼ì¥í• ë§Œí•œ í†µê³„ì  ê·¼ê±°ê°€ ì¶©ë¶„í•˜ë‹¤.

------------------------------------------------------------------------

- Kruskal Wallis H ê²€ì • ì§„í–‰
```{python}
#| echo: true
from scipy.stats import kruskal

grouped_values = [group['ì‚¬ê³ ê±´ìˆ˜'].values for _, group in accident_df.groupby('ì‹œë„ëª…')]
stat, p = kruskal(*grouped_values)
stat, p
```

------------------------------------------------------------------------

- Kruskal Wallis H ê²€ì • ê²°ê³¼

> \[!ğŸ¯\] ê° ì§€ì—­ë³„ í‰ê·  ì‚¬ê³ ê±´ìˆ˜ì˜ ì¤‘ì•™ê°’ì´ ì ì–´ë„ í•˜ë‚˜ëŠ” **ë‹¤ë¥´ë‹¤**ê³  ì£¼ì¥í•  í†µê³„ì  ê·¼ê±°ê°€ ì¶©ë¶„í•˜ë‹¤!

------------------------------------------------------------------------

- ì‚¬í›„ê²€ì • : Dunn's test ì‹œê°í™”

```{python}
#| echo: true
#| code-fold: true
import scikit_posthocs as sp_post

posthoc = sp_post.posthoc_dunn(accident, val_col='ì‚¬ê³ ê±´ìˆ˜', group_col='ì‹œë„ëª…', p_adjust='bonferroni')
# Bonferroni ìˆ˜ì •ì„ í†µí•´ ê°€ì„¤ ê²€ì •ì˜ ìœ ì˜ìˆ˜ì¤€ì„ ì¡°ì •

# ì‹œê°í™”
plt.figure(figsize=(10, 7))
sns.heatmap(posthoc, 
            annot=True, 
            fmt=".3f", 
            cmap="coolwarm_r", 
            cbar_kws={'label': 'p-value'}, 
            linewidths=0.5,
            square=True)
plt.title("Dunnâ€™s Test: ì§€ì—­ ê°„ ì‚¬ê³ ê±´ìˆ˜ ì°¨ì´ (p-value heatmap)")
plt.xticks(rotation=45)
plt.yticks(rotation=0)
plt.tight_layout()
plt.show()
```

------------------------------------------------------------------------

- ê°€ì„¤ 3 ë¶„ì„ ì§„í–‰ : ë‹¨ì†ì¹´ë©”ë¼ ìˆ˜ëŠ” ì‚¬ê³  ê±´ìˆ˜ ë¹„êµ

```{python}
accident_df = pd.read_csv('../team2/data/accident.csv', encoding='cp949')
c_df = pd.read_csv('../team2/data/camera.csv')

sido_map = {
    'ì„œìš¸íŠ¹ë³„ì‹œ': 'ì„œìš¸',
    'ë¶€ì‚°ê´‘ì—­ì‹œ': 'ë¶€ì‚°',
    'ëŒ€êµ¬ê´‘ì—­ì‹œ': 'ëŒ€êµ¬',
    'ì¸ì²œê´‘ì—­ì‹œ': 'ì¸ì²œ',
    'ê´‘ì£¼ê´‘ì—­ì‹œ': 'ê´‘ì£¼',
    'ëŒ€ì „ê´‘ì—­ì‹œ': 'ëŒ€ì „',
    'ìš¸ì‚°ê´‘ì—­ì‹œ': 'ìš¸ì‚°',
    'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ': 'ì„¸ì¢…',
    'ê²½ê¸°ë„': 'ê²½ê¸°',
    'ê°•ì›íŠ¹ë³„ìì¹˜ë„': 'ê°•ì›',
    'ì¶©ì²­ë¶ë„': 'ì¶©ë¶',
    'ì¶©ì²­ë‚¨ë„': 'ì¶©ë‚¨',
    'ì „ë¶íŠ¹ë³„ìì¹˜ë„': 'ì „ë¶',
    'ì „ë¼ë‚¨ë„': 'ì „ë‚¨',
    'ê²½ìƒë¶ë„': 'ê²½ë¶',
    'ê²½ìƒë‚¨ë„': 'ê²½ë‚¨',
    'ì œì£¼íŠ¹ë³„ìì¹˜ë„': 'ì œì£¼'
}
c_df['ì‹œë„ëª…'] = c_df['ì‹œë„ëª…'].replace(sido_map)
```

------------------------------------------------------------------------

- ë‹¨ì†ì¹´ë©”ë¼ ì„¤ì¹˜ ìˆ˜ì— ë”°ë¥¸ ì‹œë„ë³„ ì‚¬ê³ ê±´ìˆ˜ í‰ê·  ë¹„êµ

<img src="photo/gdfgrape.png" style="float: right" width="300"/>

```{python}
#| echo: true
#| code-fold: true
#| eval: false
import geopandas as gpd
import plotly.express as px
import plotly.graph_objects as go

# geopandasë¡œ shp íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
gdf = gpd.read_file('../team2/data/BND_SIDO_PG.shp')
print(gdf.crs) # ì¢Œí‘œê³„ í™•ì¸

gdf = gdf.to_crs(epsg=4326) # WGS84 (4326) ì¢Œí‘œê³„ë¡œ ë³€í™˜


# GeoJSON íŒŒì¼ë¡œ ì €ì¥ 
gdf.to_file('../team2/data/BND_SIDO_PG.geojson', driver='GeoJSON')

# geojson íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° 
import json
with open('../team2/data/BND_SIDO_PG.geojson', encoding='utf-8') as f:
    geojson_data = json.load(f)
print(geojson_data.keys()) # í™•ì¸ ìš©ë„ 
print(geojson_data['features'][1]['properties']) # í™•ì¸ ìš©ë„

# ì¹´ë©”ë¼ ë°ì´í„°ì—ì„œ groupbyë¡œ ì‹œë„ë³„ ì¹´ë©”ë¼ ìˆ˜ ì§‘ê³„í•œ DataFrame ìƒì„±
agg_cam = camera.groupby('ì‹œë„ëª…',as_index=False)['ë¬´ì¸êµí†µë‹¨ì†ì¹´ë©”ë¼ê´€ë¦¬ë²ˆí˜¸'].count()
agg_cam.columns = ['SIDO_NM','ì¹´ë©”ë¼í•©ê³„']
```

```{python}
#| echo: true
#| code-fold: true
#| eval: false
# plotly ë¡œ ì§€ë„ ì‹œê°í™” 
fig = px.choropleth_mapbox(
agg_cam,
geojson=geojson_data,
locations="SIDO_NM",
featureidkey="properties.SIDO_NM",
color="ì¹´ë©”ë¼í•©ê³„",
color_continuous_scale="Blues",
mapbox_style="carto-positron",
center={"lat": 37.5665, "lon": 126.9780},
zoom=5,
opacity=1,
title="ì‹œë„ ë³„ ì¹´ë©”ë¼ ìˆ˜",
)
fig.update_layout(margin={"r":0,"t":30,"l":0,"b":0})
fig.show()
```

------------------------------------------------------------------------

```{python}
#| echo: true
# ì»¬ëŸ¼ëª… í†µì¼0
camera_count = c_df.groupby(['ì‹œë„ëª…', 'ì‹œêµ°êµ¬ëª…']).size().reset_index(name='ë‹¨ì†ì¹´ë©”ë¼ìˆ˜')
camera_count.rename(columns={'ì‹œêµ°êµ¬ëª…': 'ì‹œêµ°êµ¬'}, inplace=True)

# ì‚¬ê³ ê±´ìˆ˜ì™€ ë³‘í•©
camera_merged_df = pd.merge(camera_count, accident_df.groupby(['ì‹œë„ëª…', 'ì‹œêµ°êµ¬'])['ì‚¬ê³ ê±´ìˆ˜'].sum().reset_index(), on=['ì‹œë„ëª…', 'ì‹œêµ°êµ¬'])


# ì‚¬ë¶„ìœ„ìˆ˜ ê¸°ë°˜ ê·¸ë£¹ ë‚˜ëˆ„ê¸° (ë§ìŒ/ ë³´í†µ/ ì ìŒ)
q1 = camera_merged_df['ë‹¨ì†ì¹´ë©”ë¼ìˆ˜'].quantile(0.25)
q3 = camera_merged_df['ë‹¨ì†ì¹´ë©”ë¼ìˆ˜'].quantile(0.75)

def classify_group(x):
    if x <= q1:
        return 'ì ìŒ'
    elif x >= q3:
        return 'ë§ìŒ'
    else:
        return 'ë³´í†µ'

camera_merged_df['ê·¸ë£¹'] = camera_merged_df['ë‹¨ì†ì¹´ë©”ë¼ìˆ˜'].apply(classify_group)
```

------------------------------------------------------------------------

```{python}
#| echo: true
#| code-fold: true
# Boxplot ì‹œê°í™”: ê° ê·¸ë£¹ì˜ ì‚¬ê³ ê±´ìˆ˜ ë¶„í¬ì™€ ì¤‘ì•™ê°’ ì°¨ì´
plt.figure(figsize=(8,5))
sns.boxplot(x='ê·¸ë£¹', y='ì‚¬ê³ ê±´ìˆ˜', data=camera_merged_df, palette='pastel')
plt.title('ë‹¨ì†ì¹´ë©”ë¼ ìˆ˜ ê·¸ë£¹ë³„ ì‚¬ê³ ê±´ìˆ˜ ë¶„í¬')
plt.xlabel('ë‹¨ì†ì¹´ë©”ë¼ ìˆ˜ ê·¸ë£¹')
plt.ylabel('ì‚¬ê³ ê±´ìˆ˜')
plt.grid(True)
plt.tight_layout()
plt.show()
```

------------------------------------------------------------------------

- ANOVA ê²€ì • ì§„í–‰

```{python}
#| echo: true
from scipy.stats import f_oneway

group_ì ìŒ = camera_merged_df[camera_merged_df['ê·¸ë£¹'] == 'ì ìŒ']['ì‚¬ê³ ê±´ìˆ˜']
group_ë³´í†µ = camera_merged_df[camera_merged_df['ê·¸ë£¹'] == 'ë³´í†µ']['ì‚¬ê³ ê±´ìˆ˜']
group_ë§ìŒ = camera_merged_df[camera_merged_df['ê·¸ë£¹'] == 'ë§ìŒ']['ì‚¬ê³ ê±´ìˆ˜']

f_stat, p_value = f_oneway(group_ì ìŒ, group_ë³´í†µ, group_ë§ìŒ)
# p-value < 0.05, ê·€ë¬´ê°€ì„¤ ê¸°ê°
```

------------------------------------------------------------------------

```{python}
from IPython.display import HTML

anova_result_df = pd.DataFrame({
    'F-í†µê³„ëŸ‰': [f_stat],
    'p-ê°’': [p_value]
})

styled = anova_result_df.style.set_table_styles([
    {'selector': 'th', 'props': [('background-color', '#f4d9c6'),
                                 ('color', '#333'),
                                 ('text-align', 'center'),
                                 ('font-family', 'Jua'),
                                 ('font-size', '1.1em')]},
    {'selector': 'td', 'props': [('text-align', 'center'),
                                 ('font-family', 'Jua'),
                                 ('padding', '10px')]},
    {'selector': '', 'props': [('border', '1px solid #ddd'),
                               ('border-collapse', 'collapse')]}
]).set_caption("ğŸš¦ ANOVA ë¶„ì„ ê²°ê³¼í‘œ")

# ì¶œë ¥
HTML(styled.to_html())
```

ğŸ‘‰ H0: ì„¸ ê·¸ë£¹ì˜ ëª¨ì§‘ë‹¨ í‰ê· ì€ ëª¨ë‘ ê°™ë‹¤. (ì°¨ì´ê°€ ìš°ì—°ì— ì˜í•œ ê²ƒ)<br>
ğŸ‘‰ H1: ì„¸ ê·¸ë£¹ ì¤‘ ì ì–´ë„ í•˜ë‚˜ëŠ” í‰ê· ì´ ë‹¤ë¥´ë‹¤.

------------------------------------------------------------------------

- Shapiro-Wilk / Levene ê²€ì • ê²°ê³¼

```{python}
#| echo: true
#| code-fold: true
results = []
# shapiro: ì •ê·œì„± ê²€ì •
from scipy.stats import shapiro

for name, group in zip(['ì ìŒ', 'ë³´í†µ', 'ë§ìŒ'], [group_ì ìŒ, group_ë³´í†µ, group_ë§ìŒ]):
    stat, p = shapiro(group)
    norm_check = 'ì •ê·œë¶„í¬ O' if p > 0.05 else 'ì •ê·œë¶„í¬ X'
    results.append([name, round(p, 4), norm_check])

# Levene: ë“±ë¶„ì‚°ì„± ê²€ì •
from scipy.stats import levene

stat, p = levene(group_ì ìŒ, group_ë³´í†µ, group_ë§ìŒ)
equal_check = 'ë“±ë¶„ì‚° O' if p > 0.05 else 'ë“±ë¶„ì‚° X'
results.append(['ë“±ë¶„ì‚°ì„± ê²€ì •', round(p, 4), equal_check])

df_results = pd.DataFrame(results, columns=['ê·¸ë£¹', 'p-value', 'ì—¬ë¶€'])

df_results
```

------------------------------------------------------------------------

- Kruskal Wallis H ê²€ì • ì§„í–‰

```{python}
#| echo: true
from scipy.stats import kruskal

h_stat, p_value = kruskal(group_ì ìŒ, group_ë³´í†µ, group_ë§ìŒ)
print(f"Kruskal-Wallis H ê²€ì • í†µê³„ëŸ‰: {h_stat:.3f}, p-value: {p_value:.4f}")
```

------------------------------------------------------------------------

- Kruskal Wallis H ê²€ì • ê²°ê³¼

> \[!ğŸ¯\] ì„¸ ê·¸ë£¹ì˜ ì¤‘ì•™ê°’ì´ ì ì–´ë„ í•˜ë‚˜ëŠ” **ë‹¤ë¥´ë‹¤** ì£¼ì¥í•  í†µê³„ì  ê·¼ê±°ê°€ ì¶©ë¶„í•˜ë‹¤!

------------------------------------------------------------------------

- ì‚¬í›„ê²€ì • : Dunn's test

```{python}
#| echo: true
#| code-fold: true
import scikit_posthocs as sp

dunn_result = sp.posthoc_dunn(camera_merged_df, val_col='ì‚¬ê³ ê±´ìˆ˜', group_col='ê·¸ë£¹', p_adjust='bonferroni')

# ê²°ê³¼ë¥¼ ìŒë³„ ë¹„êµ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
pairs = []
for i, group_a in enumerate(dunn_result.index):
    for j, group_b in enumerate(dunn_result.columns):
        if i < j:  # ì¤‘ë³µ ì œê±° (í•œ ë²ˆë§Œ ë¹„êµ)
            pairs.append({
                'ê·¸ë£¹ A': group_a,
                'ê·¸ë£¹ B': group_b,
                'p-value': dunn_result.iloc[i, j]
            })

# ì •ë¦¬ëœ ë°ì´í„°í”„ë ˆì„ ë§Œë“¤ê¸°
dunn_pairs_df = pd.DataFrame(pairs)

dunn_pairs_df
```

------------------------------------------------------------------------

- ê°€ì„¤ 4 ë¶„ì„ ì§„í–‰ : ë„ë¡œë…¸ì„  ìœ ë¬´ëŠ” ë”°ë¼ ì‚¬ê³  ê±´ìˆ˜ ì°¨ì´ ë¹„êµ

```{python}
#| echo: true

# ë„ë¡œë…¸ì„ ë²ˆí˜¸ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ë§Œ True, ì•„ë‹ˆë©´ False
c_df['ë„ë¡œë…¸ì„ ìˆìŒ'] = c_df['ë„ë¡œë…¸ì„ ë²ˆí˜¸'].notna()

# ì‹œêµ°êµ¬ë³„ ë„ë¡œë…¸ì„  ìœ ë¬´ ì¤‘ ê°€ì¥ ë§ì€ ìƒíƒœê°’ ê¸°ì¤€
roadline_status = c_df.groupby(['ì‹œë„ëª…', 'ì‹œêµ°êµ¬ëª…'])['ë„ë¡œë…¸ì„ ìˆìŒ'] \
                      .agg(lambda x: x.value_counts().index[0]) \
                      .reset_index(name='ë„ë¡œë…¸ì„ ìœ ë¬´')

roadline_status.rename(columns={'ì‹œêµ°êµ¬ëª…': 'ì‹œêµ°êµ¬'}, inplace=True)

accident_with_roadline = pd.merge(
    accident_df[['ì‹œë„ëª…', 'ì‹œêµ°êµ¬', 'ì‚¬ê³ ê±´ìˆ˜']],
    roadline_status,
    on=['ì‹œë„ëª…', 'ì‹œêµ°êµ¬'])
```

------------------------------------------------------------------------

```{python}
#| echo: true
#| code-fold: true
accident_with_roadline['ë„ë¡œë…¸ì„ ìœ ë¬´'] = accident_with_roadline['ë„ë¡œë…¸ì„ ìœ ë¬´'].map({True: 'ìˆìŒ', False: 'ì—†ìŒ'})

plt.figure(figsize=(6, 4))
sns.boxplot(data=accident_with_roadline, x='ë„ë¡œë…¸ì„ ìœ ë¬´', y='ì‚¬ê³ ê±´ìˆ˜', palette='Set3')
plt.title('ë„ë¡œë…¸ì„  ìœ ë¬´ì— ë”°ë¥¸ ì‚¬ê³ ê±´ìˆ˜ ë¶„í¬')
plt.xlabel('ë„ë¡œë…¸ì„  ìœ ë¬´')
plt.ylabel('ì‚¬ê³ ê±´ìˆ˜')
plt.grid(True)
plt.tight_layout()
plt.show()
```

------------------------------------------------------------------------

- ë…ë¦½ 2í‘œë³¸ T ê²€ì •
```{python}
#| echo: true
from scipy.stats import shapiro, ttest_ind, mannwhitneyu

group_with = accident_with_roadline[accident_with_roadline['ë„ë¡œë…¸ì„ ìœ ë¬´'] == 'ìˆìŒ']['ì‚¬ê³ ê±´ìˆ˜']
group_without = accident_with_roadline[accident_with_roadline['ë„ë¡œë…¸ì„ ìœ ë¬´'] == 'ì—†ìŒ']['ì‚¬ê³ ê±´ìˆ˜']

t_stat, p_value = ttest_ind(group_with, group_without, equal_var=False)

results = t_stat, p_value
```

------------------------------------------------------------------------

- ë…ë¦½ 2í‘œë³¸ T ê²€ì •
```{python}
ì—¬ë¶€ = 'ì°¨ì´ ìˆìŒ' if p_value < 0.05 else 'ì°¨ì´ ì—†ìŒ'

t_stat, p_value = ttest_ind(group_with, group_without, equal_var=False)

results = [['ë„ë¡œë…¸ì„  ìœ ë¬´ì— ë”°ë¥¸ ì‚¬ê³ ê±´ìˆ˜ ë¹„êµ', f"{p_value:.3f}", ì—¬ë¶€]]

# DataFrame ìƒì„±
df_results = pd.DataFrame(results, columns=['ë¹„êµ í•­ëª©', 'p_value', 'ì—¬ë¶€'])

df_results
```

------------------------------------------------------------------------

- Shaprio-Wilk ê²€ì • / Mann-Whitney U ê²€ì •

```{python}
#| echo: true
from scipy.stats import shapiro, ttest_ind, mannwhitneyu

stat, p = shapiro(group_with)
out_stat, out_p = shapiro(group_without)

stat, p = mannwhitneyu(group_with, group_without)
```

------------------------------------------------------------------------

- Shaprio-Wilk ê²€ì • / Mann-Whitney U ê²€ì •

```{python}
# ì •ê·œì„± ê²€ì •
results = []
stat1, p1 = shapiro(group_with)
result1 = 'ì •ê·œë¶„í¬' if p1 > 0.05 else 'ì •ê·œë¶„í¬ ì•„ë‹˜'
results.append(['ë„ë¡œë…¸ì„  ìˆìŒ', round(p1, 4), result1])

stat2, p2 = shapiro(group_without)
result2 = 'ì •ê·œë¶„í¬' if p2 > 0.05 else 'ì •ê·œë¶„í¬ ì•„ë‹˜'
results.append(['ë„ë¡œë…¸ì„  ì—†ìŒ', round(p2, 4), result2])

# ë¹„ëª¨ìˆ˜ ê²€ì • (Mann-Whitney U)
mw_stat, mw_p = mannwhitneyu(group_with, group_without)

# ê²°ê³¼ DataFrame ìƒì„±
results.append(['Mann-Whitney U ê²€ì •', round(mw_p, 4), 'ìœ ì˜í•œ ì°¨ì´ ìˆìŒ' if mw_p < 0.05 else 'ì°¨ì´ ì—†ìŒ'])

df_results = pd.DataFrame(results, columns=['ë„ë¡œë…¸ì„ ìœ ë¬´ / ê²€ì •', 'p-value', 'íŒì •'])

styled_df = df_results.style.set_table_attributes('class="styled-table"')

styled_df
```

------------------------------------------------------------------------

- Levene ê²€ì • / Brunner Munzel ê²€ì •

```{python}
#| echo: true
# ë“±ë¶„ì‚°ì„± ê²€ì •
from scipy.stats import levene
stat, p = levene(group_with, group_without)

from scipy.stats.mstats import brunnermunzel
stat, pvalue = brunnermunzel(group_with, group_without, alternative='two-sided')
```

------------------------------------------------------------------------

- Levene ê²€ì • / Brunner Munzel ê²€ì •

```{python}
# ì •ê·œì„± ê²€ì •
results = []
stat, p = levene(group_with, group_without)
result1 = 'ë“±ë¶„ì‚°' if p1 > 0.05 else 'ë“±ë¶„ì‚° ì•„ë‹˜'
results.append(['Levene', round(p1, 4), result1])

stat, pvalue = brunnermunzel(group_with, group_without, alternative='two-sided')
result2 = 'ë¶„í¬ìœ„ì¹˜ ë™ì¼' if p2 > 0.05 else 'ë¶„í¬ìœ„ì¹˜ ë™ì¼ X'
results.append(['BM', round(p2, 4), result2])

df_results = pd.DataFrame(results, columns=['ê²€ì •', 'p-value', 'íŒì •'])

styled_df = df_results.style.set_table_attributes('class="styled-table"')

styled_df
```

------------------------------------------------------------------------

- Brunner Munzel ê²€ì • ê²°ê³¼

> \[!ğŸ¯\] ë‘ ê·¸ë£¹ ê°„ì˜ ì¤‘ì•™ê°’ì— ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ìˆë‹¤ê³  ì£¼ì¥í• ë§Œí•œ í†µê³„ì  ê·¼ê±°ê°€ ì¶©ë¶„í•˜ë‹¤. <br> ì¦‰, **ë„ë¡œë…¸ì„  ìœ ë¬´**ì— ë”°ë¼ **ì‚¬ê³  ê±´ìˆ˜ ë¶„í¬**ì— í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ì¡´ì¬í•˜ë‹¤ ì£¼ì¥ ê°€ëŠ¥í•¨!

------------------------------------------------------------------------

- íšŒê·€ëª¨ë¸ ë¶„ì„ ì§„í–‰

```{python}
#| echo: true
camera['ë„ë¡œë…¸ì„ ìˆìŒ'] = camera['ë„ë¡œë…¸ì„ ë²ˆí˜¸'].notna()
camera.rename(columns={'ì‹œêµ°êµ¬ëª…': 'ì‹œêµ°êµ¬'}, inplace=True)

camera_count = camera.groupby(['ì‹œë„ëª…', 'ì‹œêµ°êµ¬']).size().reset_index(name='ë‹¨ì†ì¹´ë©”ë¼ìˆ˜')
camera_merged_df = pd.merge(camera_count, accident.groupby(['ì‹œë„ëª…', 'ì‹œêµ°êµ¬'])['ì‚¬ê³ ê±´ìˆ˜'].sum().reset_index(), on=['ì‹œë„ëª…', 'ì‹œêµ°êµ¬'])

merged_df = pd.merge(camera_merged_df, camera[['ì‹œë„ëª…', 'ì‹œêµ°êµ¬', 'ë„ë¡œì¢…ë¥˜', 'ë„ë¡œë…¸ì„ ìˆìŒ']], on=['ì‹œë„ëª…', 'ì‹œêµ°êµ¬'])

summary_df = (
    merged_df.groupby(['ì‹œë„ëª…', 'ì‹œêµ°êµ¬'])
    .agg({
        'ë‹¨ì†ì¹´ë©”ë¼ìˆ˜': 'first',
        'ì‚¬ê³ ê±´ìˆ˜': 'first',
        'ë„ë¡œë…¸ì„ ìˆìŒ': 'mean'  # True ë¹„ìœ¨
    })
    .reset_index()
)

# ì»¬ëŸ¼ëª… ì •ë¦¬
summary_df = summary_df[['ì‹œêµ°êµ¬', 'ë‹¨ì†ì¹´ë©”ë¼ìˆ˜', 'ì‚¬ê³ ê±´ìˆ˜', 'ë„ë¡œë…¸ì„ ìˆìŒ']]
summary_df.rename(columns={'ë„ë¡œë…¸ì„ ìˆìŒ': 'ë„ë¡œë…¸ì„ ë¹„ìœ¨'}, inplace=True)
```

------------------------------------------------------------------------

- íšŒê·€ëª¨ë¸ ë¶„ì„ ì§„í–‰

```{python}
#| echo: true
pop_df = pd.read_csv('../team2/data/ì‹œêµ°êµ¬_ë³„_ì¸êµ¬ìˆ˜.csv')

pop_df = pop_df.rename(columns={pop_df.columns[0]: 'ì‹œêµ°êµ¬', pop_df.columns[1]: 'ì¸êµ¬ìˆ˜'})
pop_df = pop_df[~pop_df['ì‹œêµ°êµ¬'].str.contains('ì´ì¸êµ¬ìˆ˜|í–‰ì •êµ¬ì—­')]  # ë¶ˆí•„ìš”í•œ í–‰ ì œê±°
pop_df = pop_df.dropna()  # í˜¹ì‹œ ëª¨ë¥¼ NaN ì œê±°
pop_df['ì¸êµ¬ìˆ˜'] = pop_df['ì¸êµ¬ìˆ˜'].astype(int)

final_df = pd.merge(summary_df, pop_df, on='ì‹œêµ°êµ¬', how='left')
```

------------------------------------------------------------------------

- íšŒê·€ëª¨ë¸ ë¶„ì„ ì§„í–‰
```{python}
#| echo: true
from statsmodels.formula.api import ols

model = ols('ì‚¬ê³ ê±´ìˆ˜ ~ ë‹¨ì†ì¹´ë©”ë¼ìˆ˜ + ë„ë¡œë…¸ì„ ë¹„ìœ¨ + ì¸êµ¬ìˆ˜', final_df).fit()
```

1. ì¢…ì†ë³€ìˆ˜ y : êµí†µì‚¬ê³  ë°œìƒ ê±´ìˆ˜
2. ë…ë¦½ë³€ìˆ˜ X : ë‹¨ì†ì¹´ë©”ë¼ ìˆ˜, ë„ë¡œë…¸ì„ ë¹„ìœ¨, ì¸êµ¬ìˆ˜ / ì‹œêµ°êµ¬ ë³„

------------------------------------------------------------------------

```{python}
print(model.summary())
```

1. Adj. R-squared: 0.699ë¡œ ì„¤ëª…ë ¥ì´ ë†’ì€ ëª¨ë¸ì„ì„ í™•ì¸!
2. Prob (F-statistic): 2.44e-87ë¡œ ìœ ì˜ë¯¸í•œ íšŒê·€ ëª¨ë¸ì„ì„ í™•ì¸!

------------------------------------------------------------------------

- OLS ê²°ê³¼ ë¶„ì„

```{python}
coef = model.params
p_values = model.pvalues
conf_int = model.conf_int()

# ë³€ìˆ˜ëª… ë¦¬ìŠ¤íŠ¸ (ì›í•˜ëŠ” í•­ëª©ë§Œ í•„í„°ë§)
variables = ['Intercept', 'ë‹¨ì†ì¹´ë©”ë¼ìˆ˜', 'ë„ë¡œë…¸ì„ ë¹„ìœ¨', 'ì¸êµ¬ìˆ˜']

# í‘œë¡œ ì •ë¦¬
summary_table = pd.DataFrame({
    'ë³€ìˆ˜': variables,
    'coef': [coef[var] for var in variables],
    'p': [p_values[var] for var in variables],
    '0.025': [conf_int.loc[var][0] for var in variables],
    '0.975': [conf_int.loc[var][1] for var in variables]
})

r2 = model.rsquared
adj_r2 = model.rsquared_adj

# í‘œ ì¶œë ¥
display(summary_table.round(3))
```

1. ëª¨ë“  íšŒê·€ê³„ìˆ˜ì˜ p-valueê°€ ìœ ì˜ìˆ˜ì¤€ 5%í•˜ì— ìœ ì˜ë¯¸í•œ ë³€ìˆ˜ì„

2. ë‹¨ì†ì¹´ë©”ë¼ìˆ˜ì˜ ì–‘ì˜ ê³„ìˆ˜ <br>
ì‹¤ì œë¡œëŠ” "ì‚¬ê³ ê°€ ë§ì€ ì§€ì—­ì— ì¹´ë©”ë¼ë¥¼ ë” ì„¤ì¹˜"í•˜ëŠ” ê²½í–¥ì´ ìˆìŒ <br>
ì—­ì¸ê³¼ ê°€ëŠ¥ì„±ì´ ì¡´ì¬

------------------------------------------------------------------------

```{python}
import matplotlib.pyplot as plt
import scipy.stats as stats
#| echo: true
#| code-fold: true
residuals = model.resid
# ì„œë¸Œí”Œë¡¯ ì„¤ì • (1í–‰ 2ì—´)
fig, axes = plt.subplots(1, 2, figsize=(10, 5))

# Q-Q plot
stats.probplot(residuals, dist="norm", plot=axes[0])
axes[0].set_title("Q-Q Plot")

# Residual plot
axes[1].scatter(model.fittedvalues, residuals)
axes[1].axhline(0, color='red', linestyle='--')
axes[1].set_xlabel('Fitted values')
axes[1].set_ylabel('Residuals')
axes[1].set_title('Residual Plot')

# ë ˆì´ì•„ì›ƒ ì¡°ì • ë° ì¶œë ¥
plt.tight_layout()
plt.show()

```


```{python}
import scipy.stats as sp
W, p = sp.shapiro(model.resid)
```

------------------------------------------------------------------------

- ì”ì°¨ì˜ ì •ê·œì„± ê²€ì •
```{python}
results = []
W, p = shapiro(model.resid)
result1 = 'ì •ê·œì„±' if p > 0.05 else 'ì •ê·œì„± X'
results.append(['shapiro', round(p, 4), result1])

df_results = pd.DataFrame(results, columns=['ê²€ì •', 'p-value', 'íŒì •'])

styled_df = df_results.style.set_table_attributes('class="styled-table"')

styled_df
```

ì”ì°¨ ê·¸ë˜í”„ì™€ ì •ê·œì„± ê²€ì •, Durbin-Watson í†µê³„ëŸ‰ê°’ì„ í†µí•´ ì˜¤ì°¨í•­ì˜ ê°€ì •ì„ ëª¨ë‘ ìœ„ë°˜í•˜ëŠ” ê²ƒì„ í™•ì¸!

ğŸ‘‰ ë”°ë¼ì„œ í•´ë‹¹ ê²€ì • ê²°ê³¼ì˜ ì‹ ë¢°ë„ê°€ ë‹¤ì†Œ ë–¨ì–´ì§ˆ ìˆ˜ ìˆë‹¤. <br>
ğŸ‘‰ ì í•©í•œ ëª¨ë¸ì„ ìƒˆë¡œ ì„¤ì •í•˜ì—¬ ë¶„ì„í•˜ëŠ” ê²ƒì´ íƒ€ë‹¹í•´ë³´ì¸ë‹¤.


------------------------------------------------------------------------

## ğŸ¯ ê²°ë¡ 

------------------------------------------------------------------------

- ê°€ì„¤ì— ëŒ€í•œ ê²€ì¦

ì•ì„œ ì§„í–‰í•œ ê²€ì • ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ, ë„ë¡œì¢…ë¥˜, ì‹œë„ë³„, ë‹¨ì†ì¹´ë©”ë¼ ìˆ˜, ë„ë¡œë…¸ì„  ìœ ë¬´ëŠ” êµí†µì‚¬ê³  ë°œìƒ ê±´ìˆ˜ì™€ í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ìš”ì¸ì„ì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤. 

- í•œê³„ì 
1. íšŒê·€ëª¨ë¸ ì”ì°¨ë¶„ì„ ê²°ê³¼ì— ë”°ë¼ ëª¨ë¸ ë¶„ì„ ê²°ê³¼ì˜ ì‹ ë¢°ë„ê°€ ë–¨ì–´ì§ˆ ìˆ˜ ìˆë‹¤.
2. í•œì •ëœ ë°ì´í„°ë¡œ ë§Œë“  ëª¨ë¸ì´ê¸° ë•Œë¬¸ì— ì¼ë°˜í™”ê°€ ê°€ëŠ¥í•œì§€ë¥¼ íŒë‹¨í•˜ê¸° ìœ„í•´ ì¶”í›„ ë¯¼ê°ë„ ë¶„ì„ì´ í•„ìš”í•´ë³´ì¸ë‹¤.
3. ë¶„ì„ ìš”ì¸ ì™¸ì— êµí†µì‚¬ê³  ë°œìƒ ê±´ìˆ˜ì™€ ê´€ë ¨ìˆëŠ” ìš”ì¸ì„ ë³€ìˆ˜ë¡œ ì¶”ê°€í•˜ì—¬ ë¶„ì„ì„ ì§„í–‰í•œë‹¤ë©´ ë³´ë‹¤ ìœ ì˜ë¯¸í•œ ê²°ê³¼ë¥¼ ë„ì¶œí•  ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.

-----------------------------------------------------------------------

## ğŸ“® ê°ì‚¬í•©ë‹ˆë‹¤!

> ë°œí‘œë¥¼ ë“¤ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ ğŸ’•

